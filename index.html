<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>湖南师大附中 · SVG 诡异解谜 Demo</title>
<style>
  :root{--bg:#070609;--accent:#d9a36b;}
  html,body{height:100%;margin:0;background:var(--bg);font-family:Segoe UI,Helvetica,Arial;color:#eee}
  #game{max-width:1000px;margin:20px auto;border-radius:8px;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.7)}
  header{display:flex;align-items:center;padding:12px;background:linear-gradient(90deg,#07080a,#0b0b0b);border-bottom:1px solid rgba(255,255,255,0.03)}
  header h1{margin:0;font-size:18px}
  #stageWrap{background:linear-gradient(180deg,#071017 0%, #0b0709 100%);padding:18px}
  #stage{width:960px;height:520px;margin:0 auto;position:relative;border-radius:6px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);background:#081018}
  /* hotspots */
  .hot{position:absolute;background:transparent;border:0;cursor:pointer}
  .hot:focus{outline:2px solid rgba(217,163,107,0.18)}
  /* UI */
  #hint{position:absolute;right:18px;top:18px;background:rgba(0,0,0,0.45);padding:8px 12px;border-radius:6px;font-size:13px;color:#ddd;border:1px solid rgba(255,255,255,0.03)}
  #inventory{height:84px;padding:10px;display:flex;gap:8px;align-items:center;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-top:1px solid rgba(255,255,255,0.03)}
  .inv-slot{width:64px;height:64px;border-radius:6px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;color:#cfcfcf;font-size:12px;border:1px solid rgba(255,255,255,0.03)}
  .modal{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);min-width:320px;background:#0b0b0b;border-radius:8px;padding:12px;border:1px solid rgba(255,255,255,0.06);box-shadow:0 20px 60px rgba(0,0,0,0.75);z-index:40}
  .hidden{display:none}
  .btn{display:inline-block;padding:8px 12px;border-radius:6px;background:var(--accent);color:#111;text-decoration:none;font-weight:700;border:none;cursor:pointer}
  .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#ddd}
  .dials{display:flex;gap:8px;margin:10px 0}
  .dial{width:56px;height:56px;background:#111;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:20px;border:1px solid rgba(255,255,255,0.04)}
  .small{font-size:12px;padding:6px 8px;border-radius:6px;background:#222;border:1px solid rgba(255,255,255,0.03);color:#fff;cursor:pointer}
  #win{position:absolute;inset:0;background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.86));display:flex;align-items:center;justify-content:center;z-index:80;color:#f7f2e7;padding:24px;text-align:center;font-size:20px}
</style>
</head>
<body>
<div id="game">
  <header>
    <h1>湖南师大附中 · SVG 解谜 Demo</h1>
    <div style="flex:1"></div>
    <div style="font-size:13px;color:#bbb">演示：点击场景中的可交互物件</div>
  </header>

  <div id="stageWrap">
    <div id="stage">
      <!-- SVG scene (全部用矢量绘制) -->
      <svg viewBox="0 0 960 520" style="width:100%;height:100%;display:block;filter:contrast(1.02) saturate(.7)">
        <defs>
          <linearGradient id="bg" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0" stop-color="#071017"/><stop offset="1" stop-color="#0f0810"/>
          </linearGradient>
        </defs>

        <rect x="0" y="0" width="960" height="520" fill="url(#bg)"/>

        <!-- ceiling lights -->
        <g opacity="0.6">
          <rect x="180" y="20" width="600" height="40" rx="8" fill="#0b1b22"/>
          <rect x="220" y="28" width="520" height="24" rx="6" fill="#12202a"/>
        </g>

        <!-- lockers left -->
        <g transform="translate(40,120)">
          <rect x="0" y="0" width="220" height="320" rx="6" fill="#1a1e21" stroke="#0e1011"/>
          <!-- locker doors -->
          <g fill="#0f1618" stroke="#0c0c0c" opacity="0.95">
            <rect x="8" y="12" width="96" height="148" rx="4"/>
            <rect x="116" y="12" width="96" height="148" rx="4"/>
            <rect x="8" y="170" width="96" height="138" rx="4"/>
            <rect x="116" y="170" width="96" height="138" rx="4"/>
          </g>
        </g>

        <!-- desk center -->
        <g transform="translate(360,320)">
          <rect x="-140" y="-32" width="280" height="120" rx="10" fill="#161212" stroke="rgba(255,255,255,0.03)"/>
          <rect x="-30" y="-6" width="80" height="56" rx="6" fill="#f7f4e9" transform="rotate(-4)"/>
          <!-- small folded paper edge -->
          <path d="M5 8 L18 8 L16 18 L5 18z" fill="#efe9d9" transform="translate(-30,-6) rotate(-4)"/>
        </g>

        <!-- door right -->
        <g id="doorSvg" transform="translate(700,110)">
          <rect x="0" y="0" width="160" height="320" rx="8" fill="#081216" stroke="#121212"/>
          <rect x="12" y="36" width="136" height="220" rx="6" fill="#0b1011"/>
          <circle cx="36" cy="210" r="8" fill="#cdb79a"/>
        </g>

        <!-- clock -->
        <g id="clockSvg" transform="translate(520,90)">
          <circle cx="0" cy="0" r="36" fill="#0b0b0b" stroke="#1a1a1a"/>
          <circle cx="0" cy="0" r="30" fill="#0e1416"/>
          <g stroke="#c9b99f" stroke-width="2" stroke-linecap="round">
            <line x1="0" y1="0" x2="0" y2="-12" transform="rotate(210)"/>
            <line x1="0" y1="0" x2="0" y2="-18" transform="rotate(40)"/>
          </g>
        </g>

        <!-- timetable poster -->
        <g transform="translate(260,60)">
          <rect x="0" y="0" width="120" height="160" rx="8" fill="#0f0e0f" stroke="#151515"/>
          <rect x="10" y="12" width="100" height="136" rx="6" fill="#e9e6db" opacity="0.95"/>
          <text x="18" y="34" font-size="12" fill="#0b0b0b">班级：高一（1）班</text>
          <text x="18" y="52" font-size="11" fill="#0b0b0b">语文 08:00</text>
          <text x="18" y="70" font-size="11" fill="#0b0b0b">数学 09:00</text>
        </g>

        <!-- subtle grain overlay -->
        <rect x="0" y="0" width="960" height="520" fill="black" opacity="0.04" style="mix-blend-mode:overlay" />
      </svg>

      <!-- clickable hotspots (absolute overlay to simplify hit areas) -->
      <button class="hot" id="hot_desk" title="桌子" style="left:360px;top:318px;width:280px;height:140px;"></button>
      <button class="hot" id="hot_lock" title="储物柜" style="left:40px;top:120px;width:220px;height:320px;"></button>
      <button class="hot" id="hot_clock" title="时钟" style="left:484px;top:54px;width:72px;height:72px;"></button>
      <button class="hot" id="hot_door" title="校门" style="left:700px;top:110px;width:160px;height:320px;"></button>

      <div id="hint">提示：点击桌子或储物柜寻找线索</div>

      <!-- modals -->
      <div id="modal_note" class="modal hidden">
        <h2>纸条</h2>
        <p>纸条写着：门的密码是 三个数字。看墙上的时钟与课表。</p>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn" id="close_note">收起并拿走纸条</button>
        </div>
      </div>

      <div id="modal_lock" class="modal hidden">
        <h2>古旧密码箱</h2>
        <p>箱子锁有三个拨盘，试着输入密码。</p>
        <div class="dials">
          <div style="display:flex;flex-direction:column;align-items:center">
            <button class="small" data-action="up" data-index="0">▲</button>
            <div class="dial" id="d0">0</div>
            <button class="small" data-action="down" data-index="0">▼</button>
          </div>
          <div style="display:flex;flex-direction:column;align-items:center">
            <button class="small" data-action="up" data-index="1">▲</button>
            <div class="dial" id="d1">0</div>
            <button class="small" data-action="down" data-index="1">▼</button>
          </div>
          <div style="display:flex;flex-direction:column;align-items:center">
            <button class="small" data-action="up" data-index="2">▲</button>
            <div class="dial" id="d2">0</div>
            <button class="small" data-action="down" data-index="2">▼</button>
          </div>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn" id="try_open">尝试打开</button>
          <button class="btn secondary" id="close_lock">关闭</button>
        </div>
      </div>

      <div id="modal_door" class="modal hidden">
        <h2>校门</h2>
        <p>大门需要钥匙才能打开。</p>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn" id="use_key">用当前钥匙尝试打开</button>
          <button class="btn secondary" id="close_door">收起</button>
        </div>
      </div>

      <div id="modal_msg" class="modal hidden">
        <h2 id="msg_title">消息</h2>
        <p id="msg_body">内容</p>
        <div style="display:flex;justify-content:flex-end">
          <button class="btn" id="close_msg">确定</button>
        </div>
      </div>

      <div id="win" class="hidden">
        <div>
          <div style="font-size:30px;font-weight:700">你成功离开了学校</div>
          <div style="margin-top:10px;color:#ccc">Demo：完全用 SVG 绘制的场景与交互</div>
        </div>
      </div>
    </div>

    <div id="inventory">
      <div style="width:12px"></div>
      <div class="inv-slot" id="inv_0">空</div>
      <div class="inv-slot" id="inv_1">空</div>
      <div class="inv-slot" id="inv_2">空</div>
      <div style="flex:1"></div>
      <div style="font-size:12px;color:#bbb;padding-right:12px">物品栏</div>
    </div>
  </div>
</div>

<script>
  // state
  const state = { inventory:[null,null,null], dials:[0,0,0], code:"731", hasKey:false, lockOpen:false };

  // utility: modals
  function showModal(id){
    document.querySelectorAll('.modal').forEach(m=>m.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
  }
  function hideModals(){ document.querySelectorAll('.modal').forEach(m=>m.classList.add('hidden')); }

  // hotspots
  document.getElementById('hot_desk').addEventListener('click', ()=> {
    if(state.inventory.includes('note')) {
      showMessage('纸条已在物品栏','你已经拿走了纸条。');
    } else {
      showModal('modal_note');
    }
  });
  document.getElementById('close_note').addEventListener('click', ()=> {
    hideModals();
    takeItem('note', svgNote());
  });

  document.getElementById('hot_lock').addEventListener('click', ()=> {
    if(state.lockOpen){
      showMessage('箱子已空','箱子里什么也没有了。');
    } else showModal('modal_lock');
  });

  // dial controls
  document.querySelectorAll('.small').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const action = btn.dataset.action, idx = +btn.dataset.index;
      state.dials[idx] = (action==='up') ? (state.dials[idx]+1)%10 : (state.dials[idx]+9)%10;
      document.getElementById('d'+idx).textContent = state.dials[idx];
    });
  });

  document.getElementById('try_open').addEventListener('click', ()=> {
    const input = state.dials.join('');
    if(input === state.code){
      state.lockOpen = true;
      hideModals();
      takeItem('key', svgKey());
      showMessage('打开了','你从箱子里拿到一把钥匙。');
    } else {
      showMessage('失败','密码不对，箱子发出沉闷的声响。');
    }
  });
  document.getElementById('close_lock').addEventListener('click', ()=> hideModals());

  document.getElementById('hot_clock').addEventListener('click', ()=> {
    showMessage('墙上时钟','时钟指针停在不寻常的角度，似乎在暗示数字 7、3、1。');
  });

  document.getElementById('hot_door').addEventListener('click', ()=> showModal('modal_door'));
  document.getElementById('close_door').addEventListener('click', ()=> hideModals());
  document.getElementById('use_key').addEventListener('click', ()=> {
    if(state.hasKey){
      hideModals();
      document.getElementById('win').classList.remove('hidden');
    } else showMessage('没有钥匙','你没有钥匙，无法打开校门。');
  });

  // message modal
  function showMessage(title, body){
    document.getElementById('msg_title').textContent = title;
    document.getElementById('msg_body').innerHTML = body;
    showModal('modal_msg');
  }
  document.getElementById('close_msg').addEventListener('click', ()=> hideModals());

  // inventory functions
  function takeItem(id, svgHtml){
    if(state.inventory.includes(id)) return;
    for(let i=0;i<state.inventory.length;i++){
      if(state.inventory[i]===null){
        state.inventory[i] = id;
        const slot = document.getElementById('inv_'+i);
        slot.innerHTML = svgHtml;
        slot.dataset.item = id;
        slot.style.cursor = 'pointer';
        slot.onclick = ()=> useItem(id);
        if(id==='key') state.hasKey = true;
        break;
      }
    }
  }

  function useItem(id){
    if(id==='note') showMessage('纸条','纸条上写着：门的密码是 731');
    else if(id==='key') showModal('modal_door');
  }

  // small debug shortcuts
  window.addEventListener('keydown', e=>{
    if(e.key==='h') showMessage('快捷','试试：点击桌子、储物柜、时钟与大门。');
    if(e.key==='0'){ state.dials=[7,3,1]; document.getElementById('d0').textContent='7';document.getElementById('d1').textContent='3';document.getElementById('d2').textContent='1'; }
    if(e.key==='Escape') hideModals();
  });

  // SVG icons for inventory (inline SVG strings)
  function svgNote(){
    return '<svg viewBox="0 0 48 48" width="48" height="48" xmlns="http://www.w3.org/2000/svg"><rect width="48" height="48" rx="6" fill="#efe9d5"/><text x="24" y="30" font-size="12" fill="#1a1a1a" text-anchor="middle">纸</text></svg>';
  }
  function svgKey(){
    return '<svg viewBox="0 0 48 48" width="48" height="48" xmlns="http://www.w3.org/2000/svg"><rect width="48" height="48" rx="6" fill="#111"/><g transform="translate(6,8)"><path d="M30 6a6 6 0 1 0-8.485 8.485L13 23v4h4l6.515-6.515A6 6 0 0 0 30 6z" fill="#d9a36b"/></g></svg>';
  }
</script>
</body>
</html>
